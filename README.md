
# ç›®å½•

[ğŸ“¦ åŸå‹è®¾è®¡](#åŸå‹è®¾è®¡)

[ğŸ’½ æ•°æ®åº“è®¾è®¡](#æ•°æ®åº“è®¾è®¡)

[ğŸ“š è·¯ç”±è®¾è®¡](#è·¯ç”±è®¾è®¡)

[ğŸ’¾ æœ¬åœ°å­˜å‚¨](#æœ¬åœ°å­˜å‚¨)

[ğŸ“‘ é¡µé¢è®¾è®¡](#é¡µé¢è®¾è®¡)

[ğŸ” é‰´æƒç›¸å…³](#é‰´æƒç›¸å…³)

[ğŸ’» éƒ¨ç½²ç›¸å…³](#éƒ¨ç½²ç›¸å…³)

*æ³¨æ„: å¾®ä¿¡å°ç¨‹åºç«¯éœ€è¦é…ç½®ä¸€ä¸ªæ­£ç¡®çš„appidæ‰èƒ½ä½¿ç”¨ã€‚æ­¤å¤–ç”±äºå®é™…éœ€æ±‚å˜æ›´ï¼Œéƒ¨åˆ†æ¨¡å—å¦‚: ç•™è¨€ã€ç§èŠç­‰æ¨¡å—å¹¶æœªä½“ç°åœ¨æ­¤ç‰ˆæœ¬çš„ä»£ç ä¸­*

# åŸå‹è®¾è®¡

### è®¾è®¡ç¨¿

> å°ç¨‹åºè®¾è®¡åŸç¨¿å‘å¸ƒåœ¨Figmaä¸Š,éœ€è¦å¯[è‡ªå–]

### éƒ¨åˆ†é¡µé¢å±•ç¤º

![é¦–é¡µ](./image/page-1.png)
![æœç´¢](./image/page-2.png)
![é€‰é¡¹](./image/page-3.png)
![è¡¨å•](./image/page-4.png)
![ç”¨æˆ·](./image/page-5.png)
![å¼€å‘è€…](./image/page-6.png)

# æ•°æ®åº“è®¾è®¡

### å­¦æ ¡ä¿¡æ¯è¡¨(schools)

> | å­—æ®µå | å­—æ®µç±»å‹ | å¯å¦ä¸ºç©º | è¯´æ˜ |
> | :---- | :---- | :---- | :---- |
> | sid  | int(6),æ— ç¬¦å·,é›¶å¡«å……,è‡ªåŠ¨é€’å¢ | å¦  | ä¸»é”®,å­¦æ ¡çš„å”¯ä¸€æ ‡è¯† |
> | name | char(32) | å¦ | å­¦æ ¡åç§° |
> | address | varchar(255) | å¦ | å­¦æ ¡åœ°å€ |
> | phone | char(32) | å¦ | å­¦æ ¡è”ç³»æ–¹å¼ |
> | createdAt | datetime | å¦ | å­¦æ ¡æ³¨å†Œæ—¶é—´,ç”±Sequelizeè‡ªåŠ¨ç®¡ç† |
> | updatedAt | datetime | å¦ | å­¦æ ¡ä¿¡æ¯æ›´æ–°æ—¶é—´,ç”±Sequelizeè‡ªåŠ¨ç®¡ç† |

### æ ¡åŒºä¿¡æ¯è¡¨(campuses)

> | å­—æ®µå | å­—æ®µç±»å‹ | å¯å¦ä¸ºç©º | è¯´æ˜ |
> | :---- | :---- | :---- | :---- |
> | cid  | int(10),æ— ç¬¦å·,é›¶å¡«å……,è‡ªåŠ¨é€’å¢ | å¦  | ä¸»é”®,æ ¡åŒºçš„å”¯ä¸€æ ‡è¯† |
> | name | char(32) | å¦ | æ ¡åŒºåç§° |
> | location | json | å¦ | å­¦æ ¡åœ°å€çš„ç»çº¬åº¦,ç”¨äºç¡®å®šç”¨æˆ·é€‰æ‹©æ‹¾å–åœ°ç‚¹æ—¶çš„åˆå§‹ä½ç½®,æ ¼å¼:{"latitude": "30", "longitude": "121"} |
> | tip | json | å¦ | è¯¥æ ¡åŒºæŒ‡å®šçš„ç”¨æˆ·å¯é€‰æ‹©å‘å¸ƒçš„ç‰©å“æ¡ç›®,æ ¼å¼:["æ‰‹æœº", "ç”µè„‘"] |
> | notice | varchar(255) | æ˜¯ | è¯¥æ ¡åŒºå‘å¸ƒçš„å…¬å‘Š |
> | createdAt | datetime | å¦ | æ ¡åŒºæ³¨å†Œæ—¶é—´,ç”±Sequelizeè‡ªåŠ¨ç®¡ç† |
> | updatedAt | datetime | å¦ | æ ¡åŒºä¿¡æ¯æ›´æ–°æ—¶é—´,ç”±Sequelizeè‡ªåŠ¨ç®¡ç† |
> | schoolSid | int(6) | å¦ | æ ¡åŒºæ‰€å±å­¦æ ¡id |

### ç”¨æˆ·ä¿¡æ¯è¡¨(users)

> | å­—æ®µå | å­—æ®µç±»å‹ | å¯å¦ä¸ºç©º | è¯´æ˜ |
> | :---- | :---- | :---- | :---- |
> | uid | char(64) | å¦ | ä¸»é”®,ç”±å¾®ä¿¡å°ç¨‹åºä¸­è¯¥ç”¨æˆ·çš„openidä¸å…¶æ‰€å±å­¦æ ¡çš„sidå…±åŒç»„æˆ(ä¸€ä¸ªopenidå¯ä¸ä¸åŒçš„å­¦æ ¡sidç»„åˆ,å³ä¸€ä¸ªç”¨æˆ·å¯æ³¨å†Œå¤šä¸ªå­¦æ ¡),å”¯ä¸€æ ‡è¯† |
> | name  | char(16) | å¦ | ç”¨æˆ·å¾®ä¿¡å |
> | image | varchar(255) | å¦ | ç”¨æˆ·å¾®ä¿¡å¤´åƒ |
> | coin | int(10) | å¦  | ç”¨æˆ·å‘å¸ƒçš„ç‰©å“è¢«ç®¡ç†å‘˜ç¡®è®¤è®¤é¢†åç»™äºˆçš„ç§¯åˆ†å¥–åŠ± |
> | createdAt | datetime | å¦ | ç”¨æˆ·æ³¨å†Œæ—¶é—´,ç”±Sequelizeè‡ªåŠ¨ç®¡ç† |
> | updatedAt | datetime | å¦ | ç”¨æˆ·ä¿¡æ¯æ›´æ–°æ—¶é—´,ç”±Sequelizeè‡ªåŠ¨ç®¡ç† |
> | campusCid | int(10) | å¦ | ç”¨æˆ·æ‰€å±æ ¡åŒºid |

### ç‰©å“å¯æ”¾ç½®åœ°ç‚¹è¡¨(places)

> | å­—æ®µå | å­—æ®µç±»å‹ | å¯å¦ä¸ºç©º | è¯´æ˜ |
> | :---- | :---- | :---- | :---- |
> | pid | int(10),æ— ç¬¦å·,é›¶å¡«å……,è‡ªåŠ¨é€’å¢ | å¦ | ä¸»é”®,å¯æ”¾ç½®åœ°ç‚¹id,å”¯ä¸€æ ‡è¯† |
> | name  | char(16) | å¦ | åœ°ç‚¹åç§° |
> | location | json | å¦ | å¯æ”¾ç½®åœ°ç‚¹çš„ç»çº¬åº¦,ç”¨äºä¸ºå¯»ç‰©è€…å¯¼èˆª,æ ¼å¼:{"latitude": "30", "longitude": "121"} |
> | createdAt | datetime | å¦ | åœ°ç‚¹æ³¨å†Œæ—¶é—´,ç”±Sequelizeè‡ªåŠ¨ç®¡ç† |
> | updatedAt | datetime | å¦ | åœ°ç‚¹ä¿¡æ¯æ›´æ–°æ—¶é—´,ç”±Sequelizeè‡ªåŠ¨ç®¡ç† |
> | campusCid | int(10) | å¦ | åœ°ç‚¹æ‰€å±æ ¡åŒºid |

### ç‰©å“ä¿¡æ¯è¡¨

> | å­—æ®µå | å­—æ®µç±»å‹ | å¯å¦ä¸ºç©º | è¯´æ˜ |
> | :---- | :---- | :---- | :---- |
> | oid | bigint(20),æ— ç¬¦å·,é›¶å¡«å……,è‡ªåŠ¨é€’å¢ | å¦ | ä¸»é”®,ç‰©å“id,å”¯ä¸€æ ‡è¯† |
> | name  | char(32) | å¦ | ç‰©å“åç§° |
> | address | json | å¦ | æ‹¾å–ç‰©å“çš„åœ°ç‚¹çš„ç»çº¬åº¦,ç”±å°ç¨‹åºæ¥å£è‡ªåŠ¨è·å–,æ ¼å¼:{"name": "æµ·å¤§å›¾ä¹¦é¦†", "address": "æµ·å¤§æ ¡å†…", "latitude": 30, "longitude": 121} |
> | time | date | å¦ | ç”¨æˆ·æ‹¾å–ç‰©å“çš„æ—¥æœŸ |
> | describe | json | æ˜¯ | ç‰©å“ç›¸å…³æè¿°,é€‰å¡«é¡¹ç›® |
> | image | json | æ˜¯ | ç‰©å“ç›¸å…³å›¾ç‰‡,é€‰å¡«,æœ€å¤šä¸‰å¼ ,ç”±ç¨‹åºè‡ªåŠ¨ç®¡ç†,ç©ºå€¼ä¼šè¢«è®¾ä¸º"\[\]",æ ¼å¼:\["/image/æ—¥æœŸ/å›¾ç‰‡åç§°"\] |
> | createdAt | datetime | å¦ | ç‰©å“ä¿¡æ¯ä¸Šä¼ æ—¶é—´,ç”±Sequelizeè‡ªåŠ¨ç®¡ç† |
> | updatedAt | datetime | å¦ | ç‰©å“ä¿¡æ¯æ›´æ–°æ—¶é—´,ç”±Sequelizeè‡ªåŠ¨ç®¡ç† |
> | userUid | char(64) | å¦ | å‘å¸ƒè¯¥æ¡ç›®çš„ç”¨æˆ·id |
> | placePid | int(10) | å¦ | è¯¥ç‰©å“æ”¾ç½®çš„æ”¾ç½®åœ°ç‚¹id |
> | claim | char(64) | æ˜¯ | è®¤é¢†ç‰©å“çš„ç”¨æˆ·id,å­—æ®µä¸ºç©ºåˆ™æ— äººè®¤é¢†,æŒ‰éœ€æ±‚åº”ç”±ç®¡ç†å‘˜å¡«å†™ç¡®è®¤ |

## å›¾ç‰‡ç´¢å¼•è¡¨(images)

> | å­—æ®µå | å­—æ®µç±»å‹ | å¯å¦ä¸ºç©º | è¯´æ˜ |
> | :---- | :---- | :---- | :---- |
> | hash | char(128) | å¦ | ä¸»é”®,å›¾ç‰‡hash,å”¯ä¸€æ ‡è¯† |
> | src | varchar(255) | å¦ | å›¾ç‰‡ç›¸å¯¹åœ°å€ |
> | type | char(64) | å¦ | å›¾åƒMIMEç±»å‹ |
> | createdAt | datetime | å¦ | å›¾ç‰‡ä¸Šä¼ æ—¶é—´,ç”±Sequelizeè‡ªåŠ¨ç®¡ç† |
> | updatedAt | datetime | å¦ | å›¾ç‰‡ä¿¡æ¯æ›´æ–°æ—¶é—´,ç”±Sequelizeè‡ªåŠ¨ç®¡ç† |

## ç”¨æˆ·æµè§ˆè¶³è¿¹è¡¨(footmarks)

> | å­—æ®µå | å­—æ®µç±»å‹ | å¯å¦ä¸ºç©º | è¯´æ˜ |
> | :---- | :---- | :---- | :---- |
> | userUid | char(64) | å¦ | ä¸»é”®,ç”¨æˆ·id,ä¸objectOidå…±åŒç¡®è®¤ä¸€æ¡è®°å½• |
> | objectOid | bigint(20) | å¦ | ä¸»é”®,ç‰©å“id,ä¸userUidå…±åŒç¡®è®¤ä¸€æ¡è®°å½• |
> | createdAt | datetime | å¦ | ç”¨æˆ·æµè§ˆç‰©å“çš„æ—¶é—´,ç”±Sequelizeè‡ªåŠ¨ç®¡ç† |
> | updatedAt | datetime | å¦ | ç›¸å…³ä¿¡æ¯æ›´æ”¹æ—¶é—´,ç”±Sequelizeè‡ªåŠ¨ç®¡ç† |

## ç”¨æˆ·æœç´¢è¡¨(searches)

> | å­—æ®µå | å­—æ®µç±»å‹ | å¯å¦ä¸ºç©º | è¯´æ˜ |
> | :---- | :---- | :---- | :---- |
> | tid | int(10),æ— ç¬¦å·,é›¶å¡«å……,è‡ªåŠ¨é€’å¢ | å¦ | ä¸»é”®,å…³é”®è¯id |
> | name | char(32) | å¦ | å…³é”®è¯åç§° |
> | count | bigint(20) | å¦ | å…³é”®è¯æœç´¢æ¬¡æ•° |
> | createdAt | datetime | å¦ | å…³é”®è¯ç¬¬ä¸€æ¬¡è¢«æœç´¢çš„æ—¶é—´,ç”±Sequelizeè‡ªåŠ¨ç®¡ç† |
> | updatedAt | datetime | å¦ | å…³é”®è¯ä¿¡æ¯æ›´æ–°çš„æ—¶é—´,ç”±Sequelizeè‡ªåŠ¨ç®¡ç† |
> | sid  | int(6) | å¦  | æ ‡ç­¾æ‰€å±å­¦æ ¡id |

# è·¯ç”±è®¾è®¡

> | id | è¯·æ±‚åœ°å€ | è¯·æ±‚æ–¹æ³• | å¤´éƒ¨æ˜¯å¦æºå¸¦JWT | æºå¸¦æ•°æ®æè¿° | è¿”å›å€¼æè¿° | è¯·æ±‚é¡µé¢ |
> | :---- | :---- | :---- | :---- | :---- | :---- | :---- |
> | 1 | /api/user/session/login  | POST | å¦ | ä¸´æ—¶code,å­¦æ ¡sid,æ ¡åŒºcid(ä»…æ³¨å†Œæ—¶å­˜åœ¨),ç”¨æˆ·å¤´åƒæ˜µç§°(ä»…æ³¨å†Œæ—¶å­˜åœ¨) | JWT,ç”¨æˆ·ä¿¡æ¯ | login.submit |
> | 2 | /api/user/info/school  | POST | å¦ | å¾®ä¿¡å°ç¨‹åºä¸´æ—¶code | å­¦æ ¡,æ ¡åŒº,è¯¥æ ¡ä¸‹æ˜¯å¦å­˜åœ¨è¯¥ç”¨æˆ· | login.onload |
> | 3 | /api/user/info/index/tip | POST | æ˜¯ | æ—  | å„ä¸ªæ ¡åŒºåç§°,å…¬å‘Š,æ ‡ç­¾,åŠå¯¹åº”çš„10æ¡ç‰©å“æ•°æ®(æ•°æ®è¦ç»è¿‡handleListå‡½æ•°å¤„ç†) | index.onload / list.searchKeyWord |
> | 4 | /api/user/info/index/list | POST | æ˜¯ | æ ¡åŒºcid,å½“å‰é¡µæœ€å°çš„ç‰©å“oid | ç‰©å“ç›¸å…³ä¿¡æ¯,å¦‚oid,å›¾ç‰‡,æè¿°ç­‰ | index.goBtm / list.goBtm |
> | 5 | /api/user/info/user-count | GET | æ˜¯ | æ—  | ç›¸å…³ç‰©å“æ•°é‡ | user.onload |
> | 6 | /api/user/info/user-object | POST | æ˜¯ | ç‚¹å‡»å›¾æ ‡çš„ç´¢å¼• | è¿”å›å¯¹åº”ç‰©å“çš„è¯¦æƒ…ä¿¡æ¯ | user.goList |
> | 7 | /api/user/info/search-tip | GET | æ˜¯ | æ—  | è¿”å›æœç´¢æ•°è¾ƒé«˜çš„å‡ æ¡çƒ­æœ | search.onload |
> | 8 | /api/user/info/details-info | POST | æ˜¯ | ç‰©å“oid,æ˜¯å¦è·å–ç‰©å“è¯¦æƒ…ä¿¡æ¯çš„flag(é¡µé¢å¯èƒ½ç›´æ¥æ¥å—å‚æ•°è¿›è¡Œæ¸²æŸ“ä¸éœ€è¦è¯·æ±‚ç‰©å“ä¿¡æ¯) | è¿”å›å‘å¸ƒè€…ä¿¡æ¯,å½“è¯·æ±‚çš„flagä¸ºtrueæ—¶è·å–ç‰©å“è¯¦æƒ…ä¿¡æ¯ | details.onload |
> | 9 | /api/user/info/submit-list | GET | æ˜¯ | æ—  | ç”¨æˆ·å¯é€‰å‘å¸ƒç‰©å“åˆ—è¡¨ | submit.onload |
> | 10 | /api/serve/img/upload | POST | æ˜¯ | å›¾ç‰‡ | å›¾ç‰‡ç›¸å¯¹åœ°å€ | submit.submitInfo |
> | 11 | /api/user/operate/submit-object-info | POST | æ˜¯ | æ‹¾å–ç‰©å“çš„åœ°ç‚¹,å›¾ç‰‡,æè¿°,æ—¶é—´ç­‰ | ok | submit.submitInfo |

# æœ¬åœ°å­˜å‚¨

> | è·¯ç”±id | key | data |
> | :---- | :---- | :---- |
> | 2 | jwt | string |
> | 2 | info |  user:{ coin,id,iamge,name } |

# é¡µé¢è®¾è®¡

> | é¡µé¢ | è¯´æ˜ |
> | :---- | :---- |
> | about | å…³äºé¡µé¢ |
> | agreement | ç”¨æˆ·åè®®é¡µé¢ |
> | details | ç‰©å“è¯¦æƒ…é¡µ |
> | developer | å¼€å‘è€…é¡µé¢ |
> | index | é¦–é¡µ |
> | list | æœç´¢é¡µå’Œç”¨æˆ·é¡µè·³è½¬åˆ°çš„ç‰©å“åˆ—è¡¨é¡µ |
> | login | ç™»å½•æ³¨å†Œé¡µ |
> | message | ä¿¡æ¯åˆ—è¡¨é¡µ,åŸä¸ç§èŠç›¸å…³,åº”æœ€æ–°éœ€æ±‚å»é™¤ç§èŠå,æœ¬é¡µé¢æš‚æ—¶ä¿ç•™ |
> | search | æœç´¢é¡µ |
> | session | ç§èŠå¯¹è¯é¡µ,åŸä¸ç§èŠç›¸å…³,åº”æ–°éœ€æ±‚å»é™¤,æš‚æ—¶ä¿ç•™ |
> | setting | è®¾ç½®é¡µ,éœ€æ±‚ä¸æ˜ç¡®,æ•…ä»…å®ç°é€€å‡ºç™»å½• |
> | space | åº•éƒ¨æ ä¸­é—´æŒ‰é’®å ä½é¡µé¢,æ— ç”¨,ä½†éœ€ä¿ç•™ |
> | submit | ä¿¡æ¯æäº¤é¡µ |
> | user | ç”¨æˆ·ä¸ªäººä¸­å¿ƒ |
> | custom-tab-bar | éé¡µé¢,åº•éƒ¨Barç»„ä»¶,ç”¨äºä¸»é¡µå’Œç”¨æˆ·ä¸ªäººä¸­å¿ƒé¡µé¢ |

# é‰´æƒç›¸å…³

> å¾®ä¿¡å°ç¨‹åºä¼šè·å–ç”¨æˆ·çš„ä¸€ä¸ªä¸´æ—¶code(5åˆ†é’Ÿæœ‰æ•ˆ)ï¼Œå¹¶å°†codeå‘é€åˆ°åç«¯ï¼Œåç«¯æ ¹æ®é…ç½®æ–‡ä»¶é‡Œçš„ä¿¡æ¯è¯·æ±‚`https://api.weixin.qq.com/sns/jscode2session`æ¢å–ç”¨æˆ·çš„openid,å°†è¯¥openidè§†ä¸ºå¯ä¿¡æ•°æ®,ä»¥æ­¤ä¸ºä¾æ®å‘æ”¾JWT

# éƒ¨ç½²ç›¸å…³

> + å¾®ä¿¡å°ç¨‹åº
>    1. åœ¨`app.js`ä¸­`globalData`ä¸‹é…ç½®æœåŠ¡å™¨åŸŸåå’Œå›¾ç‰‡ä¸Šä¼ æ¥å£
>    2. æŒ‰ç…§ä¸€èˆ¬å¾®ä¿¡å°ç¨‹åºéƒ¨ç½²æ­¥éª¤éƒ¨ç½²
> + åç«¯
>    1. æ•°æ®åº“ç›¸å…³é…ç½®åœ¨`config`ç›®å½•ä¸‹,æ‰‹åŠ¨åˆ›å»ºæ•°æ®åº“
>    2. å°†`/utils/mountModel.js`ä¸‹`åŒæ­¥æ¨¡å‹`éƒ¨åˆ†è§£é™¤æ³¨é‡Š,ç›´æ¥è¿è¡Œç¨‹åºå»ºç«‹æ•°æ®åº“ç›¸å…³è¡¨(ä¹Ÿå¯æ‰§è¡Œsqlæ–‡ä»¶åˆ›å»º)
>    3. æ‰‹åŠ¨å¡«å…¥å­¦æ ¡,æ ¡åŒº,æ”¾ç½®åœ°ç‚¹ç­‰ä¿¡æ¯
>    4. åœ¨å¾®ä¿¡å…¬ä¼—å¹³å°æ³¨å†Œç”¨æˆ·,å¹¶åœ¨`config`ç›®å½•çš„æ–‡ä»¶ä¸­é…ç½®ç›¸å…³çš„`appid`å’Œ`secret`
>    5. è¿è¡Œç¨‹åº,å¯ä½¿ç”¨NGINXè¿›è¡Œåä»£

[è‡ªå–]: https://www.figma.com/community/file/1125376984135152418